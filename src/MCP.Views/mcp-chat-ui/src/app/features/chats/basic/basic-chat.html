<mat-sidenav-container class="chat-container">
  <mat-sidenav
    #optionsSidenav
    mode="over"
    position="end"
    class="options-sidenav"
    [opened]="showOptions()"
  >
    <div class="options-content">
      <app-chat-options
        (optionsChanged)="onOptionsChanged()"
      ></app-chat-options>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar color="primary" class="chat-header">
      <mat-icon class="header-icon">chat</mat-icon>
      <span>AI Chat Assistant</span>

      <span class="spacer"></span>

      <div class="toolbar-actions">
        <mat-form-field appearance="outline" class="provider-select compact">
          <mat-label>Provider</mat-label>
          <mat-select
            [value]="selectedProvider()"
            (valueChange)="selectedProvider.set($event)"
          >
            @for (provider of providers(); track provider) {
            <mat-option [value]="provider">{{
              formatProviderName(provider)
            }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
        <button
          mat-icon-button
          (click)="toggleOptions()"
          matTooltip="Chat Options"
          [color]="showOptions() ? 'accent' : ''"
        >
          <mat-icon>settings</mat-icon>
        </button>

        <button
          mat-icon-button
          (click)="confirmClearChat()"
          matTooltip="Clear chat"
          [disabled]="messages().length === 0"
        >
          <mat-icon>clear_all</mat-icon>
        </button>

        <app-action-icon-button
          [icon]="'download'"
          [tooltip]="'Export chat as JSON'"
          [disabled]="messages().length === 0"
          (action)="exportChat()"
        />
        <app-action-icon-button
          [icon]="'upload'"
          [tooltip]="'Import chat from JSON'"
          (action)="triggerImport()"
        />
        <input
          #fileInput
          type="file"
          accept="application/json"
          style="display: none"
          (change)="importChat($event)"
        />
      </div>
    </mat-toolbar>

    <div class="chat-content">
      <app-message-list
        [messages]="messages()"
        [isLoading]="isLoading()"
        [isAwaitingResponse]="chatService.isAwaitingResponse()"
      ></app-message-list>

      <app-message-input
        (messageSubmit)="onMessageSubmit($event)"
        [disabled]="isLoading()"
      >
      </app-message-input>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
